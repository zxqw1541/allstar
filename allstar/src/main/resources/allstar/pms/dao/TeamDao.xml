<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="allstar.pms.dao.TeamDao">

	<sql id="select_inc">
		select t.tno, t.eno, t.name, t.total_num, t.join_num, t.win, t.draw, t.lose, t.fee, t.meet_day,
		        t.introduce, t.emblem, t.aform, t.pst_no, t.bas_addr, e.eno as e_eno, e.name as e_name
	</sql>

	<resultMap type="team" id="teamMap">
		<id column="tno" property="tno" />
		<result column="eno" property="eno" />
		<result column="name" property="name" />
		<result column="total_num" property="totalNum" />
		<result column="join_num" property="joinNum" />
		<result column="win" property="win" />
		<result column="draw" property="draw" />
		<result column="lose" property="lose" />
		<result column="fee" property="fee" />
		<result column="meet_day" property="meetDay" />
		<result column="introduce" property="introduce" />
		<result column="emblem" property="emblem" />
		<result column="aform" property="aForm" />
		<result column="pst_no" property="postNo" />
		<result column="bas_addr" property="baseAddr" />
		<association property="event" javaType="Event">
		   <id column="e_eno" property="eno" />
		   <result column="e_name" property="name"/>
		</association>
	</resultMap>

  <select id="selectAll" resultMap="teamMap">
    select * from team;
  </select>
  
	<select id="selectList" resultMap="teamMap" parameterType="map">
		<include refid="select_inc" />
		from team t left outer join event e on t.eno=e.eno
		order by
		<choose>
			<when test="keyword == 'name'">t.name </when>
			<otherwise>t.tno </otherwise>
		</choose>
		<choose>
			<when test="align == 'desc'">desc</when>
			<otherwise>asc</otherwise>
		</choose>
		limit #{startIndex}, #{length}

	</select>

	<insert id="insert" parameterType="team">
		insert into team(eno,name,total_num,fee,meet_day,introduce,
		            emblem,aform,pst_no,bas_addr)
		values(#{eno},#{name},#{totalNum},#{fee},#{meetDay},#{introduce},
		            #{emblem},#{aForm},#{postNo},#{baseAddr})
	</insert>

	<delete id="delete" parameterType="int">
		delete from team where tno=#{tno}
	</delete>

	<update id="update" parameterType="team">
		update team set
		  total_num=#{totalNum},
		  fee=#{fee},
		  meet_day=#{meetDay},
		  introduce=#{introduce},
		  emblem=#{emblem},
		  aform=#{aForm},
		  pst_no=#{postNo},
		  bas_addr=#{baseAddr}
		where tno=#{tno}
	</update>

	<select id="selectOne" resultMap="teamMap" parameterType="int">
		<include refid="select_inc" />
		from team t left outer join event e on t.eno=e.eno
		where tno=#{tno}
	</select>
</mapper>
