<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>

<link type="text/css" rel="stylesheet" href="/allstar/css/header_footer.css" />

 <script type="text/javascript" src="/allstar/js/jquery.cookie.js"></script>
<script type="text/javascript" src="/allstar/js/jquery.session.js"></script>

 <script src="/allstar/js/jquery.leanModal.min.js"></script>
 <script src="../lib/alertify.js/alertify.js"></script>
  
<script>

$(function() {
    $('a[rel*=leanModal]').leanModal({ top : 200, closeButton: ".modal_close" });   
});

function close_modal(modal_id){
    $("#lean_overlay").fadeOut(200);
  $(modal_id).css({"display":"none"})
                        }
</script>

</head>
<body>


<div id='top_header'>
<header >
<a href="/allstar/main2.html"><img src="/allstar/images/allstar.png" style="float: left;"></a>
 <div class="auth">
          <span id="login" style="display:none;">
              <a style='margin-right:10px;color:white;' id='go' rel='leanModal' href='#signup'>로그인</a>
       <a style='margin-right:10px;color:white;' href='#signin' rel='leanModal'>회원가입</a>
         </span>
         <span id="logout" style="display:none;">
           
        </span>
            <span> <a  style='display:none; color:white; margin-left:5px;' id='out' href=''>로그아웃</a></span>
            </div>
            <div id="cssmenu" >
              <nav >
                <ul >
                  <li  class='active has-sub' ><a href="/allstar/board/boardList.html"><span>종목별 게시판</span></a>
                    <ul id="eventmenu">
                        <li><a href="/allstar/board/boardList.html?event=2">농구</a></li>
                        <li><a href="/allstar/board/boardList.html?event=3">축구</a></li>
                        <li><a href="/allstar/board/boardList.html?event=4">야구</a></li>
                        <li><a href="/allstar/board/boardList.html?event=5">볼링</a></li>
                        <li><a href="/allstar/board/boardList.html?event=6">탁구</a></li>
                    </ul>
                 </li>
                  <li class='has-sub'><a href="/allstar/competition/competitionList.html">대회</a>
                    <ul>
                      <li><a href="/allstar/competition/competitionList.html?event=2">농구</a></li>
                        <li><a href="/allstar/competition/competitionList.html?event=3">축구</a></li>
                        <li><a href="/allstar/competition/competitionList.html?event=4">야구</a></li>
                        <li><a href="/allstar/competition/competitionList.html?event=5">볼링</a></li>
                        <li><a href="/allstar/competition/competitionList.html?event=6">탁구</a></li>
                   </ul>
                </li>
                  <li class='has-sub'><a href="/allstar/team/teamList.html">팀</a>
                    <ul>
                        <li><a href="/allstar/team/teamList.html?event=2">농구</a></li>
                        <li><a href="/allstar/team/teamList.html?event=3">축구</a></li>
                        <li><a href="/allstar/team/teamList.html?event=4">야구</a></li>
                        <li><a href="/allstar/team/teamList.html?event=5">볼링</a></li>
                        <li><a href="/allstar/team/teamList.html?event=6">탁구</a></li>
                   </ul></li>
              </ul>
        </nav>
        </div>
</header>
<!-- header end -->


</div>

<!-- 가입 폼 -->
<div id="signin">
      <div id="signup-ct">
        <div id="signup-header">
          <h2>회원가입</h2>
        </div>
        
        <form action="" method="POST">
          <div class="txt-fld">
            <label for="username">아이디</label>
            <input id="id_signin" class="good_input" name="username" type="text" />

          </div>
        
          <div class="txt-fld">
            <label for="password">비밀번호</label>
            <input id="pass_signin" name="password" type="password" >

          </div>
                    <div class="txt-fld">
            <label for="password2">비밀번호 확인</label>
            <input  id="pass_signin2" name="password2" type="password" onkeyup="checkPass(); return false;"><br>
<span id="confirmMessage" class="confirmMessage"></span>
          </div>
          <div class="btn-fld">
          <button id="addBtn" type="button">가입하기 &raquo;</button>

</div>
         </form>
      </div>
    </div>
    <script>
    	function checkPass()
    	{
    	    var pass1 = document.getElementById('pass_signin');
    	    var pass2 = document.getElementById('pass_signin2');
    	    var message = document.getElementById('confirmMessage');
    	    var goodColor = "#66cc66";
    	    var badColor = "#ff6666";
    	    if(pass1.value == pass2.value){
    	        pass2.style.backgroundColor = goodColor;
    	        message.style.color = goodColor;
    	        message.innerHTML = "Passwords Match!"
    	    }else{
    	        pass2.style.backgroundColor = badColor;
    	        message.style.color = badColor;
    	        message.innerHTML = "Passwords Do Not Match!"
    	    }
    }
    </script>
<!-- 가입폼 끝 -->



<!-- 로그인 폼 -->

<div id="signup">
      <div id="signup-ct">
        <div id="signup-header">
          <h2>로그인</h2>
          <p>아이디와 비밀번호를 입력하세요.</p>
          <a class="modal_close" href="#"></a>
        </div>
        
        <form action="" method="POST">
            <div id="loading"></div>
          <div class="txt-fld">
            <label for="id_input">아이디</label>
            <input id="id_input" class="good_input" name="username" type="text" />

          </div>
        
          <div class="txt-fld">
            <label for="pass_input">비밀번호</label>
            <input id="pass_input" name="password" type="password" />

          </div>
          <div class="btn-fld">
          <button id="loginBtn" type="button">로그인 &raquo;</button>

</div>
         </form>
      </div>
    </div>


<script>
//로그인 시작


  $('#loginBtn').click( function(event) {

	      var id = document.getElementById('id_input');
	      var pass = document.getElementById('pass_input');
	      
	      if (id.value == '') {
	          alertify.alert("아이디를 입력해주세요.");
	          return;
	      }
	      
				if (pass.value == '') {
				     alertify.alert("비밀번호를 입력해주세요.");
				     return;
				 }
	      
         console.log("login?");
        $.post('/allstar/auth/ajax/login.do', {
          id : $('#id_input').val(),
          password : $('#pass_input').val()
        }, function(resultObj) {
        	 console.log("login-ing");
          var ajaxResult = resultObj.ajaxResult;
          if (ajaxResult.status == "success") {
              emailSession = ajaxResult.data.id;
              numSession = ajaxResult.data.mno;
              photoSession= ajaxResult.data.photo;
              sessionStorage.setItem('loginSession',emailSession);
              sessionStorage.setItem('mem_num',numSession);
              sessionStorage.setItem('mem_photo',photoSession);
            console.log("success");
            close_modal("#signup");
            $("#logout").show();
            $("#out").show();
            $("#login").hide();
            console.log(sessionStorage.getItem("loginSession"));
            var session_photo=sessionStorage.getItem("mem_photo");
            console.log("login photo : "+session_photo);
            if(session_photo == 'null')
                session_photo = 'allstardefault.png';
              var session_id=sessionStorage.getItem("loginSession");
              var span = $("#logout");
              $("<a href='/allstar/member/Member_info.html'><img src='/allstar/member/img/"+session_photo+"' style='width: 70px; height: 70px;'></a>"
                    +"<a style='margin-left:10px;color:white;'  href='/allstar/member/Member_info.html'>"+session_id+"</a>")
                      .appendTo(span);
              location.reload();
          } else {
            alertify.alert("아이디와 패스워드가 일치하지 않습니다.");
          }
        }, 'json');
        
      });
  
  
  $(document).ready( function() {
  if (sessionStorage.getItem("loginSession") != undefined) {
    $("#logout").show();
    $("#out").show();
    $("#login").hide();
    console.log(sessionStorage.getItem("loginSession"));
    var session_photo=sessionStorage.getItem("mem_photo");
    if(session_photo == 'null')
        session_photo = 'allstardefault.png';
      var session_id=sessionStorage.getItem("loginSession");
      var span = $("#logout");
      $("<a href='/allstar/member/Member_info.html'><img src='/allstar/member/img/"+session_photo+"' style='width: 70px; height: 70px;'></a>"
            +"<a style='margin-left:10px;color:white;'  href='/allstar/member/Member_info.html'>"+session_id+"</a>")
              .appendTo(span);
        
  }else {
    $("#login").show();
    $("#logout").hide();
    $("#out").hide();

  }
}); 
  
  $('#out').click( function(event) {
    $.session.clear();
    console.log("logout");
    
    $("#login").show();
    $("#logout").hide();
    $("#out").hide();
    location.reload();
  });
  
  // 로그인 끝
  
   
      $(function() {
        $("#addBtn").click(function() {
          var form = $('form')[0];
          var data = new FormData();
          var pass1 = document.getElementById('pass_signin');
          var pass2 = document.getElementById('pass_signin2');
          var id = document.getElementById('id_signin');
          
          if (id.value == '') {
              alertify.alert("아이디를 입력해주세요.");
              return;
          }
          
          if (pass1.value != pass2.value) {
            alertify.alert("비밀번호가 다릅니다."); 
            return;
          } else if (pass1.value == '' || pass2.value == '') {
            alertify.alert("비밀번호를 입력해주세요.");
            return;
          }
          
          data.append('id', $('#id_signin').val());
          data.append('pwd', $('#pass_signin').val());
          
           $.ajax({
             url : "/allstar/member/ajax/add.do",
             data : data,
             type : "POST",
             dataType: "json",
             enctype: 'multipart/form-data',
             processData: false, 
             contentType:false,
             success : function(result) {
               console.log(result.ajaxResult.status);
                if(result.ajaxResult.status =="success"){
               console.log(result);
               alertify.alert("가입에 성공했습니다.", function(){
	                location.href = "";
               });
                }else if(result.ajaxResult.status == "error"){
                  alertify.alert("이미 존재하는 아이디이거나 잘못된 가입 정보입니다. ", function(){
	                  location.href = "javascript:;";
                  });
                }
               } 
           });
        });
      });
    

</script>
</body>
</html>