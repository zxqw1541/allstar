<!DOCTYPE html>
<html>
<head>
<title></title>
<link rel="stylesheet" type="text/css" href="css/header_footer.css" />
<link rel="stylesheet" type="text/css" href="css/normalize.css" />
<link rel="stylesheet" type="text/css" href="css/component.css" />
<link rel="stylesheet" type="text/css" href="../team/css/main.css">
<link rel='stylesheet' type='text/css' href="../team/css/style.css" />
<link rel="stylesheet" type="text/css" href="css/overlay.css" />
<link rel="stylesheet" href="../lib/bootstrap/css/bootstrap.css">

<meta charset="UTF-8">

<script src="js/jquery-1.11.3.js"></script>
<script type="text/javascript" src="js/preview.image.js"></script>

<script> 
$(function(){
  $("#header").load("header.html"); 
  $("#footer").load("footer.html"); 
});
</script>
</head>
<body>
<div id="header"></div>
<div id="space"></div>

<!---start-content---->
<div class="content">
  <div class="wrap">
    <div id="main" role="main" style="margin:0">

    <div class="btnArea clearFix">
      <p class="fR">
        <a id="newBtn" class="newbtn btnType1">새 팀</a>
      </p><br>
      
         <form id="teamForm">
          <select id="tevent" onchange="options[selectedIndex].value&&self.location.reload(true)">
              <option value=''>종목</option>
              <option value='2'>농구</option>
              <option value='3'>축구</option>
              <option value='4'>야구</option>
              <option value='5'>볼링</option>
              <option value='6'>탁구</option>
          </select>
          <select id="tplaynum" onchange="options[selectedIndex].value&&self.location.reload(true)">
              <option value=''>경기수</option>
              <option value='low'>적은 순</option>
              <option value='high'>많은 순</option>
          </select>
          <select id="tregion" onchange="options[selectedIndex].value&&self.location.reload(true)">
              <option value=''>지역</option>
              <option value='1'>강원도</option>
              <option value='2'>경기도</option>
              <option value='3'>경상남도</option>
              <option value='4'>경상북도</option>
              <option value='5'>광주광역시</option>
              <option value='6'>대구광역시</option>
              <option value='7'>대전광역시</option>
              <option value='8'>부산광역시</option>
              <option value='9'>서울특별시</option>
              <option value='10'>세종특별자치시</option>
              <option value='11'>울산광역시</option>
              <option value='12'>인천광역시</option>
              <option value='13'>전라남도</option>
              <option value='14'>전라북도</option>
              <option value='15'>제주특별자치도</option>
              <option value='16'>충청남도</option>
              <option value='17'>충청북도</option>
          </select>
          <select id="tjoin" onchange="options[selectedIndex].value&&self.location.reload(true)">
              <option value=''>가입여부</option>
              <option value='true'>가능</option>
              <option value='false'>불가능</option>
          </select>
          <select id="tdate" onchange="options[selectedIndex].value&&self.location.reload(true)">
              <option value=''>등록순</option>
              <option value='tno desc'>최신순</option>
              <option value='tno asc'>오래된순</option>
          </select>
        </form>
    
    
      </div><br>

      <ul id="tiles">
        <!-- These are our grid blocks -->
        <!-- End of grid blocks -->
      </ul>
    </div>
  </div>
</div>

<!-- add Pop up -->
<div id="team_overlay_t"></div>

<!-- 추가 팝업 폼 --> 
<div id="addForm" class="teamform_overlay_layer" class="popup">
  <div class="popup_left">
      <form id='addTeamForm' class="form-horizontal" enctype="multipart/form-data">
        <div class="form-group">
          <label for="fname" class="col-sm-2 control-label">팀명</label>
          <div class="col-sm-10">
            <input type="text" class="form-control" id="fname"
              placeholder="팀명을 입력해주세요.">
          </div>
        </div>
        <div class="form-group">
          <label for="fevent" class="col-sm-2 control-label">종목</label>
          <div class="col-sm-10">
            <select id="fevent">
              <option value=''>종목선택</option>
              <option value='2'>농구</option>
              <option value='3'>축구</option>
              <option value='4'>야구</option>
              <option value='5'>볼링</option>
              <option value='6'>탁구</option>
            </select>
          </div>
        </div>

        <div class="form-group">
          <label for="ftotalnum" class="col-sm-2 control-label">인원수</label>
          <div class="col-sm-10">
            <input type="text" class="form-control" id="ftotalnum"
              placeholder="인원수를 입력해주세요.">
          </div>
        </div>
        <div class="form-group">
          <label for="ffee" class="col-sm-2 control-label">회비</label>
          <div class="col-sm-10">
            <input type="text" class="form-control" id="ffee"
              placeholder="회비를 입력해주세요.">
          </div>
        </div>
        <div class="form-group">
          <label for="fmeetday" class="col-sm-2 control-label">정모요일</label>
          <div class="col-sm-10">
            <input type="text" class="form-control" id="fmeetday"
              placeholder="정모요일을 입력해주세요.">
          </div>
        </div>
        <div class="form-group">
          <label for="fpostno" class="col-sm-2 control-label">우편번호</label>
          <div class="col-sm-10">
            <input type="text" class="form-control" id="fpostno"
              placeholder="우편번호(숫자 5자리)를 입력해주세요.">
          </div>
        </div>
        <div class="form-group">
          <label for="faddr" class="col-sm-2 control-label">연고지</label>
          <div class="col-sm-10">
            <input type="text" class="form-control" id="faddr"
              placeholder="연고지를 입력해주세요.">
          </div>
        </div>
        <div class="form-group">
          <label for="femblem" class="col-sm-2 control-label">엠뷸럼</label>
          <div class="col-sm-10">
            <input type="file" class="form-control" id="femblem" onchange="fileSelected()">
          </div>
        </div>
        <div class="form-group">
          <label for="fintroduce" class="col-sm-2 control-label">팀 소개</label>
          <div class="col-sm-10">
            <textarea id="fintroduce" class="form-control" rows='10' cols='60'
              placeholder="팀소개를 입력해주세요."></textarea>
          </div>
        </div>
        <div class="form-group">
          <label for="faform" class="col-sm-2 control-label">팀 가입양식</label>
          <div class="col-sm-10">
            <textarea id="faform" class="form-control" rows='10' cols='60'
              placeholder="팀 가입 양식을 입력해주세요."></textarea>
          </div>
        </div>

        <div class="form-group">
          <div class="col-sm-offset-2 col-sm-10">
            <button id='regTeamBtn' type='button'
              class="newForm btn btn-primary btn-xs">등록</button>
          </div>
        </div>
        <div>
          <img id="preview_img" />
        </div>
      </form>
  </div>
</div>

<div id="footer"></div>
  <!---//End-content---->
  <!----wookmark-scripts---->
  <script src="../team/js/jquery.imagesloaded.js"></script>
  <script src="../team/js/jquery.wookmark.js"></script>
  <script type="text/javascript">
        (function ($){
          var $tiles = $('#tiles'),
              $handler = $('li', $tiles),
              $main = $('#main'),
              $window = $(window),
              $document = $(document),
              options = {
                autoResize: true, // This will auto-update the layout when the browser window is resized.
                container: $main, // Optional, used for some extra CSS styling
                offset: 20, // Optional, the distance between grid items
                itemWidth:280 // Optional, the width of a grid item
              },
              pageNo = 2;
              listSize = 0;
              keyword = 'event';
              $.getJSON('../team/ajax/all.do', function(resultObj) {
                listSize = resultObj.size;
              });
              
          /**
           * Reinitializes the wookmark handler after all images have loaded
           */
          function applyLayout() {
            $tiles.imagesLoaded(function() {
              // Destroy the old handler
              if ($handler.wookmarkInstance) {
                $handler.wookmarkInstance.clear();
              }
    
              // Create a new layout handler.
              $handler = $('li', $tiles);
              $handler.wookmark(options);
            });
          }
          
          /**
           * When scrolled all the way to the bottom, add more tiles
           */
           function onScroll() {
             if ($(window).data('ajaxready') === false)
                  return;
             
             if (listSize >= $('li', $tiles).length) {
                 // Check if we're within 100 pixels of the bottom edge of the broser window.
               var winHeight = window.innerHeight ? window.innerHeight : $window.height(), // iphone fix
                   closeToBottom = ($window.scrollTop() + winHeight > $document.height() - 500);
                 
               if (closeToBottom) {
                 $(window).data('ajaxready', false);

                 $.ajax({
                	  url:'../team/ajax/list.do?pageNo=' + pageNo,
                	  type:'GET',
                	  async:false,
                	  dataType:'json',
                	  data:'resultObj',
                	  success:function(resultObj) {
                      if (resultObj.teams.length != 0) {
                         pageNo++;
                         var tiles = $("#tiles");
                         for (var team of resultObj.teams) {
                           var emblem = team.emblem; 
                             
                             if(emblem == null){
                               emblem = "allstardefault.png";
                             }
                           
                             $( "<li>" )
                             .html("<img src= '../team/img/tl_" + emblem + "' width='280'>" +
                                  "<div class='post-info'>" + 
                                  "<div class='post-basic-info'>" + 
                                  "<h3><a class='detailLnk' href='#' teamNo='" + team.tno + "'>" + team.name + "</a></h3><span>" +
                                   "<a href='#'><label></label>" + "by 팀장" + "</a></span>" +
                                   "<p>" + team.event.name + "</p>" + 
                                   "<p>" + team.joinNum + " / " + team.totalNum +
                                   "</p></div></div>")
                           .appendTo(tiles);
                         }
                         // 팀 링크에 클릭 이벤트 리스너 등록
                         $("a.detailLnk").click(clickDetailLnk);
                      }
        	          }
        	       });

                 // 팀 이름을 클릭했을 때 호출될 함수
                 function clickDetailLnk(event) {
                   event.preventDefault();
                   location.href = "teamForm.html?tno=" + $(event.target).attr("teamNo");
                 }
                 
                 setTimeout(function() {
                   $(window).data('ajaxready', true);
                   applyLayout();
                 }, 500);
               }
             }
           };
           
          // Call the layout function for the first time
          applyLayout();
    
          // Capture scroll event.
          $window.bind('scroll.wookmark', onScroll);

        })(jQuery);
  </script>
  <!----//wookmark-scripts---->

  <script>
  $('#teamForm').change(function(){
/*      alert("test"); */
	});
  
  /* var sevent;
  function selectEvent(param) {
	    sevent = param.value;
	    reload(sevent);
	    location.reload();
	} */

	
  onunload = function()
  {
		self.name = '';
		
    var tevent = document.getElementById('tevent');
    self.name = self.name + 'e' + tevent.selectedIndex + 'e';

    var tplaynum = document.getElementById('tplaynum');
    self.name = self.name + 'p' + tplaynum.selectedIndex + 'p';
    
    var tregion = document.getElementById('tregion');
    self.name = self.name + 'r' + tregion.selectedIndex + 'r';
    
    var tjoin = document.getElementById('tjoin');
    self.name = self.name + 'j' + tjoin.selectedIndex + 'j';
    
    var tdate = document.getElementById('tdate');
    self.name = self.name + 'd' + tdate.selectedIndex + 'd';
  } 
	
  onload = function()
  {
	  var idx;
	  
    var tevent = document.getElementById('tevent');
    tevent.selectedIndex = (idx = self.name.split('e')) ? idx[1] : 0;
    var eVal = tevent.options[tevent.selectedIndex].value;
    console.log(eVal);
    
    var idx1, tplaynum = document.getElementById('tplaynum');
    tplaynum.selectedIndex = (idx1 = self.name.split('p')) ? idx1[1] : 0;
    var pVal = tplaynum.options[tplaynum.selectedIndex].value;
    console.log(pVal);
    
    var tregion = document.getElementById('tregion');
    tregion.selectedIndex = (idx = self.name.split('r')) ? idx[1] : 0;
    var rVal = tregion.options[tregion.selectedIndex].value;
    console.log(rVal);

    var tjoin = document.getElementById('tjoin');
    tjoin.selectedIndex = (idx = self.name.split('j')) ? idx[1] : 0;
    var jVal = tjoin.options[tjoin.selectedIndex].value;
    console.log(jVal);

    var tdate = document.getElementById('tdate');
    tdate.selectedIndex = (idx = self.name.split('d')) ? idx[1] : 0;
    var dVal = tdate.options[tdate.selectedIndex].value;
    console.log(dVal);
    
    
    
    
  }

    
  $.ajax({
	  url:'../team/ajax/list.do',
	  type:'GET',
	  async:false,
	  dataType:'json',
	  data:'resultObj',
    success:function(resultObj) {
		    var tiles = $("#tiles");
		    for (var team of resultObj.teams) {
		      var emblem = team.emblem; 
		      
		      if(emblem == null){
		        emblem = "allstardefault.png";
		      }
		      
		      $( "<li>" )
		        .html("<img src= '../team/img/tl_" + emblem + "' width='280'>" +
		              "<div class='post-info'>" + 
		              "<div class='post-basic-info'>" + 
		              "<h3><a class='detailLnk' href='#' teamNo='" + team.tno + "'>" + team.name + "</a></h3><span>" +
		              "<a href='#'><label></label>" + "by 팀장" + "</a></span>" +
		              "<p>" + team.event.name + "</p>" + 
		              "<p>" + team.joinNum + " / " + team.totalNum + 
		              "</p></div></div>")
		        .appendTo(tiles);
		      }
		      // 팀 링크에 클릭 이벤트 리스너 등록
		      $("a.detailLnk").click(clickDetailLnk);
    	 
       }
     });
  
    // 팀 이름을 클릭했을 때 호출될 함수
    function clickDetailLnk(event) {
      event.preventDefault();
      location.href = "teamForm.html?tno=" + $(event.target).attr("teamNo");
    }
  
    var url;
   function reload(param) {
	   if (param > 1) {
		   url = '../team/ajax/list.do?keyword=event&event=' + param;
	   } else {
		   url = '../team/ajax/list.do';
	   }
	   
	   $.ajax({
		    url:url,
		    type:'GET',
		    async:false,
		    dataType:'json',
		    data:'resultObj',
		    success:function(resultObj) {
		    	$("#tiles li").remove();
		        var tiles = $("#tiles");
		        for (var team of resultObj.teams) {
		          var emblem = team.emblem; 
		          
		          if(emblem == null){
		            emblem = "allstardefault.png";
		          }
		          
		          $( "<li>" )
		            .html("<img src= '../team/img/tl_" + emblem + "' width='280'>" +
		                  "<div class='post-info'>" + 
		                  "<div class='post-basic-info'>" + 
		                  "<h3><a class='detailLnk' href='#' teamNo='" + team.tno + "'>" + team.name + "</a></h3><span>" +
		                  "<a href='#'><label></label>" + "by 팀장" + "</a></span>" +
		                  "<p>" + team.event.name + "</p>" + 
		                  "<p>" + team.joinNum + " / " + team.totalNum + 
		                  "</p></div></div>")
		            .appendTo(tiles);
		          }
		          // 팀 링크에 클릭 이벤트 리스너 등록
		          $("a.detailLnk").click(clickDetailLnk);
		       
		       }
		     });
   } 
    
    
    
  </script>

<script>
/* add form 오버레이 */
$(document).ready(function() { 
  $('#newBtn').click(function(){ 
    $('#addForm, #team_overlay_t').fadeIn();
    $('body').css('overflow', 'hidden');
  }); 
  $('#team_overlay_t, .close').click(function(e){ 
    e.preventDefault(); 
    $('#addForm, #team_overlay_t, #detailForm').fadeOut();
    $('body').css('overflow', 'auto');
  }); 
});


  /* 등록폼 전송 */
  $(function() {
    $("#regTeamBtn").click(function() {
      var form = $('form')[0];
      var data = new FormData();
      $.each($('#femblem')[0].files, function(i, file) {
        data.append('file', file)
      });
      
      if($('#fevent').val() != "")
          data.append('eno', $('#fevent').val());
        
        if($('#fname').val() != "")
          data.append('name', $('#fname').val());
        
        if($('#ftotalnum').val() != "")
          data.append('totalNum', $('#ftotalnum').val());
        
        if($('#ffee').val() != "")
          data.append('fee', $('#ffee').val());
        
        if($('#fmeetday').val() != "")
          data.append('meetDay', $('#fmeetday').val());
        
        if($('#fbaseaddr').val() != "")
          data.append('baseAddr', $('#fbaseaddr').val());
        
        if($('#fpostno').val() != "")
          data.append('postNo', $('#fpostno').val());

        data.append('introduce', $('#fintroduce').val());
        data.append('aForm', $('#faform').val());

       $.ajax({
         url : "../team/ajax/add.do",
         data : data,
         type : "POST",
         dataType: "json",
         enctype: 'multipart/form-data',
         processData: false, 
         contentType:false,
         success : function(result) {
           console.log(result);
         if (result.ajaxResult.status == "success") {
            location.href = "/allstar/ui/teamList.html";
           } else {
            alert("팀 등록에 실패했습니다.");
           }
         },
         error : function(result){
            alert('error');
         }
       });
    });
  });
  
</script>

</body>
</html>