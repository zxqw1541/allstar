<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<link rel="stylesheet" type="text/css" href="css/tos/comp.css" />
<link rel="stylesheet" type="text/css" href="css/tos/myteam.css" />
<style>
#lean_overlay {
    position: fixed;
    z-index:100;
    top: 100px;
    left: 0px;
    height:100%;
    width:100%;
    background: #000;
    display: none;
}
#stateChange {
background-color:white;
display: none;
}
#stateChange img {
width:200px;
height:250px;
}

#stateChange ul {
padding: 45px;
}
#stateChange button {
margin: 10px;
}
</style>

</head>
<body>

	<div>
	<h2 style="text-align: center;">내가 개설한 팀</h2>
		<div class="container demo-3">

			<ul class="grid cs-style-4" id="myteams" >


			</ul>

      <div id="myTeamInfo_detail" style="display:none;margin:auto;  width: 900px; height:100%;">

<!-- Emblem -->
<div id="team_top">
</div>

<!-- 가입신청 알림 -->
<div id="apply_alert" >
</div>


<!-- 회원 목록 -->
<div id="mem_list" >

</div>
<!-- 회원 목록 끝 -->


<!-- 팀정보 -->
<div id="info" style="float:left; font-size:20px; padding: 50px;">

</div>
<!-- 팀정보 끝 -->
<div style="height:20px; width:100%; float:left;"></div>
<!-- 가입신청현황 -->
<div id="apply_state" style="float:left;">
<h2 style="margin-left:50px;">신규가입 신청</h2>
<ul id="new_apply" >
</ul>
<h2 style="margin-left:50px;">대기중인 신청</h2>
<ul id="wait_apply" >
</ul>
<h2 style="margin-left:50px;">거절한 신청</h2>
<ul id="reject_apply" >
</ul>
</div>
      </div>
      
      
		</div>
		  <div id="stateChange" >

	</div>
	<div style="height:500px;"></div>

</div>
	
	<script>
$.getJSON('../member/ajax/memberJoin.do?mno=' +sessionStorage.getItem("mem_num"), function(resultObj) {
    console.log(resultObj.data);
    $("myTeamInfo_detail").hide();
    if(resultObj.status == "success"){
    for (var joinTeam of resultObj.data ){

    	if(joinTeam.level == 1) {
	    	var event = 0 ;
	    	console.log("tno : "+joinTeam.tno+"  eno : "+joinTeam.team.eno);
	    	switch(joinTeam.team.eno){
	    	case 2:  event = "농구";
	    	   break;
	    	case 3:  event = "축구";
	        break;
	    	case 4:  event = "야구";
	        break;
	    	case 5:  event = "탁구";
	        break;
	    	case 6:  event = "볼링";
	        break;
	    	}
	    	var emblem = joinTeam.team.emblem;
	    	if(emblem == null){
	    		emblem = "allstardefault.png";
	    	}
	    	var ul = $('#myteams');
	    	$("<li style='margin-left: 120px;'>")
	    	.html("<figure><div>"
	    			+"<img src='../team/img/"+emblem+"' style='width:300px;' alt='"+ joinTeam.team.name+"'></div>"
	    			+"<figcaption>"
	    			+"<h3>"+joinTeam.team.name+"</h3>"
	    			+"<span>팀장 : " + joinTeam.member.name + "</span><br>"
	    			+"<span >연고지 : "+joinTeam.team.postNo+" "+joinTeam.team.baseAddr+" </span><br>"
	    			+"<span >종목 : "+event+" </span><br>"
	    			+"<span>전적 : "+joinTeam.team.win+" 승  "+joinTeam.team.draw+" 무  "+joinTeam.team.lose+" 패</span><br>"
	    			+"<span>내용 : "+joinTeam.team.introduce+"</span><br>"
	    	          +"<a id='myteam_info"+joinTeam.tno+"' href='javascript:;'onclick='scroll(0,0)' teamNo='"+joinTeam.tno+"'>팀 정보 보기</a>"
	    			+"</figcaption></figure></li>"
	    	).appendTo(ul);
    } else {
    	 var ul = $('#myteams');
         $("<li>").html(+ "현재 개설한 팀이 없습니다. </li>").appendTo(ul);
    }
    	$("#myteam_info"+joinTeam.tno+"").click(myTeamInfo);
    }
    } else {
    	var ul = $('#myteams');
    	$("<li>").html(+ "현재 개설한 팀이 없습니다. </li>").appendTo(ul);
    }
});


function myTeamInfo(event){
	var captain = null;
	$("#myteams").hide();
	$("#myTeamInfo_detail").show();
$.getJSON('../team/ajax/detail.do?tno=' + $(event.target).attr('teamNo'), function(resultObj) {
	var ajaxResult = resultObj.ajaxResult;
	console.log($(event.target).attr('teamNo'));
	var team = ajaxResult.data;
	var div =$("#team_top");
	$("<span>")
	.html("<img src='../team/img/"+team.emblem+"'  ></span> "
	    +"<span style='float:left; margin-left: 55px; margin-top: 75px;'><h1>"+team.name+"</h1></span>")
	    .appendTo(div);
	});

	$.getJSON('../member/ajax/teamJoin.do?tno=' + $(event.target).attr('teamNo'), function(resultObj) {
	var waiting = 0;
	for(var joinTeam of resultObj.data){
	if(joinTeam.state == 0)
	  waiting ++;
	if(joinTeam.level == 1)
		captain=joinTeam.member.name ;
	}
	var div = $("#apply_alert");
	$("<a style='margin:auto;'>")
	.html("대기중 가입 신청수 : " + waiting + "개  </a>").appendTo(div);

	for(var joinTeam of resultObj.data){
	  if(joinTeam.state == 1) {
	var div = $("#mem_list") ;
	$("<figure >")
	.html("<img src='../member/img/"+joinTeam.member.photo+"' >"
	+"<figcaption>"+joinTeam.member.name+"</figcaption>"
	+"</figure>").appendTo(div);
	}
	}
	});
	
	$.getJSON('../team/ajax/detail.do?tno=' + $(event.target).attr('teamNo'), function(resultObj) {
		var ajaxResult = resultObj.ajaxResult;
		  var team = ajaxResult.data;
		  var div = $("#info");
		  $("<span style='display: inherit;'>")
		  .html("<span  style='display: inherit;'>팀장 : "+ captain +" </span><br>"
				  + "<span style='display: inherit;'> 정모일 : "+team.meetDay+" </span><br>"
				  +"  <span style='display: inherit;'> 종목 : "+team.event.name+" </span><br>"
				  +"<span style='display: inherit;'> 가입현황 : "+team.joinNum+"명 / "+team.totalNum+"명 </span><br>"
				  +"  <span style='display: inherit;'> 전적 : "+team.win+"승 "+team.draw+"무 "+team.lose+"패 </span><br>"
				  +"<span >연고지 : "+team.baseAddr+"</span><br>"
				  ).appendTo(div);
	});

	/* 상태 표시 창 */
	$.getJSON('../member/ajax/teamJoin.do?tno='+$(event.target).attr('teamNo'),function(resultObj){
		for(var joinTeam of resultObj.data){
			  if(joinTeam.state == 0){
				  var ul = $("#new_apply");
				  $("<li>")
				  .html("<a href='#stateChange'  rel='leanModal' memberNo='"+ joinTeam.mno +"' class='stateChan'><span>신청일 : "+joinTeam.createdDate+"</span>"
						  +"<span>아이디 : "+joinTeam.member.id+"</span>"
						  +"<span>나이 : "+joinTeam.member.age+"</span> "
						  +"<span>성 : "+joinTeam.member.gender+"</span></a> ").appendTo(ul);
			  }	
			  if(joinTeam.state == 0){
		          var ul = $("#wait_apply");
		          $("<li>")
		          .html("<a href='#stateChange' rel='leanModal'  memberNo='"+ joinTeam.mno +"'  class='stateChan'><span>신청일 : "+joinTeam.createdDate+"</span>"
		              +"<span>아이디 : "+joinTeam.member.id+"</span>"
		              +"<span>나이 : "+joinTeam.member.age+"</span> "
		              +"<span>성 : "+joinTeam.member.gender+"</span></a> ").appendTo(ul);
		        }
			  if(joinTeam.state == -1){
		          var ul = $("#reject_apply");
		          $("<li>")
		          .html("<a href='#stateChange' rel='leanModal'  memberNo='"+ joinTeam.mno +"' class='stateChan'><span>신청일 : "+joinTeam.createdDate+"</span>"
		              +"<span>아이디 : "+joinTeam.member.id+"</span>"
		              +"<span>나이 : "+joinTeam.member.age+"</span> "
		              +"<span>성 : "+joinTeam.member.gender+"</span></a> ").appendTo(ul);
		        } 
		}
		$('a[rel*=leanModal]').leanModal({ closeButton: ".modal_close" });   
	

	$('.stateChan').click(function (event){
		 $('#stateChange').empty();
	   console.log("memberNo: "+$(event.currentTarget).attr("memberNo"));
	   var mno=$(event.target).attr("memberNo");
	 $.getJSON('../member/ajax/detail.do?mno='+$(event.currentTarget).attr("memberNo"), function(resultObj){
	     var ajaxResult=resultObj.ajaxResult;
	     var member = ajaxResult.data;
	     var div = $('#stateChange');
	     $("<ul>")
	     .html("<li><img src='../member/img/"+member.photo+"'></li>"
	         +"<li><span>아이디 : "+member.id+"</span></li>"
	         +"<li><span>이름 : "+member.name+"</span></li>"
	         +"<li><span>성별 : "+member.gender+"</span></li>"
	         +"<li><span>나이 : "+member.age+"</span></li>"
	         +"<li><span>주소 : "+member.baseAddr+"</span></li>"
	         +"<li><span>자기소개 : "+member.introduce+"</span></li>"
	         +"<button type='button' id='accept' memberNo='"+ joinTeam.mno +"'>승인</button>"
	         +"<button type='button' id='wait' memberNo='"+ joinTeam.mno +"'>보류</button>"
	         +"<button type='button' id='denial' memberNo='"+ joinTeam.mno +"'>거절</button>")
	         .appendTo(div);
	   });
});
	$('#accept').click(function (event){
		$.post('../member/ajax/changeState.do', {
	          mno:  $(event.target).attr("memberNo"),
	          state: 1
	      }, function(resultObj) {
	        var ajaxResult = resultObj.ajaxResult;
	        if (ajaxResult.status == "success") {
	          alert("상태 변경했습니다.");
	        } else {
	            alert("변경에 실패했습니다.");
	        }
	      }, 'json');
	  });
});
	
	
}
</script>


</body>
</html>