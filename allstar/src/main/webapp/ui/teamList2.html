<!DOCTYPE html>
<html>
<head>
<title></title>
<link rel="stylesheet" type="text/css" href="css/header_footer.css" />
<link rel="stylesheet" type="text/css" href="css/normalize.css" />
<link rel="stylesheet" type="text/css" href="css/component.css" />
<link rel="stylesheet" type="text/css" href="../team/css/main.css">
<link rel='stylesheet' type='text/css' href="../team/css/style.css" />
<link rel="stylesheet" type="text/css" href="css/overlay.css" />

<meta charset="UTF-8">

<script src="js/jquery-1.11.3.js"></script>
<script src="js/jquery.leanModal.min.js"></script>
<script type="text/javascript" src="js/preview.image.js"></script>

<script> 
$(function(){
  $("#header").load("header.html"); 
  $("#footer").load("footer.html"); 
});

$(function() {
    $('li[rel*=leanModal]').leanModal({ closeButton: ".modal_close" });   
});
</script>
</head>
<body>
<div id="header"></div>
<div id="space"></div>

<!---start-content---->
<div class="content">
  <div class="wrap">
    <div id="main" role="main" style="margin:0">

    <div class="btnArea clearFix">
      <p class="fR">
        <a id="newBtn" class="newbtn btnType1" rel='leanModal' href='#add_team'>새 팀</a>
      </p><br>
      
         <form id="teamForm">
          <select id="tevent">
              <option value=''>종목</option>
              <option value='2'>농구</option>
              <option value='3'>축구</option>
              <option value='4'>야구</option>
              <option value='5'>볼링</option>
              <option value='6'>탁구</option>
          </select>
          <select id="tnum">
              <option value=''>경기수</option>
              <option value='1'>적은 순</option>
              <option value='2'>많은 순</option>
          </select>
          <select name="tregion">
              <option>지역</option>
              <option>강원도</option>
              <option>경기도</option>
              <option>경상남도</option>
              <option>경상북도</option>
              <option>광주광역시</option>
              <option>대구광역시</option>
              <option>대전광역시</option>
              <option>부산광역시</option>
              <option>서울특별시</option>
              <option>세종특별자치시</option>
              <option>울산광역시</option>
              <option>인천광역시</option>
              <option>전라남도</option>
              <option>전라북도</option>
              <option>제주특별자치도</option>
              <option>충청남도</option>
              <option>충청북도</option>
          </select>
          <select id="tjoin">
              <option value=''>가입여부</option>
              <option value='1'>가능</option>
              <option value='2'>불가능</option>
          </select>
          <select id="tdate">
              <option value=''>등록순</option>
              <option value='1'>최신순</option>
              <option value='2'>오래된순</option>
          </select>
        </form>
    
    
      </div><br>

      <ul id="tiles">
        <!-- These are our grid blocks -->
        <!-- End of grid blocks -->
      </ul>
    </div>
  </div>
</div>

<div id="footer"></div>

<!-- 등록 폼 -->
  <div id="add_team">
    <div id="add_team-header">
      <h2>새 팀 등록</h2>
      <a class="modal_close" href="#"></a>
    </div>
    <div id="add_team_img">
      <img id="preview_img" src="img/allstardefault.png"/>
    </div>
    <form id='addTeamForm' class="form-horizontal" enctype="multipart/form-data">
          
    <div class="txt-fld">
      <label for="fname">팀명</label>
      <input id="fname" class="good_input" type="text" placeholder="팀명을 입력해주세요."/>
    </div>
            
    <div class="txt-fld">
      <label for="fevent">종목</label>
      <div>
        <select id="fevent" class="good_input">
          <option value=''>종목선택</option>
          <option value='2'>농구</option>
          <option value='3'>축구</option>
          <option value='4'>야구</option>
          <option value='5'>볼링</option>
          <option value='6'>탁구</option>
        </select>
      </div>
    </div>   
    <div class="txt-fld">
      <label for="ftotalnum">인원수</label>
      <input id="ftotalnum" class="good_input" type="text" placeholder="숫자를 입력해주세요."/>
    </div>
          
    <div class="txt-fld">
      <label for="ffee">회비</label>
      <input id="ffee" class="good_input" type="text" placeholder="숫자를 입력해주세요."/>
    </div>
          
    <div class="txt-fld">
      <label for="fmeetday">정모요일</label>
      <input id="fmeetday" class="good_input" type="text" placeholder="정모요일을 입력해주세요."/>
    </div>
          
      <div class="txt-fld">
        <label for="fpostno">우편번호</label>
        <input id="fpostno" class="good_input" type="text" placeholder="우편번호(숫자 5자리)를 입력해주세요."/>
      </div>
      
      <div class="txt-fld">
        <label for="faddr">연고지</label>
        <input id="faddr" class="good_input" type="text" placeholder="연고지를 입력해주세요."/>
      </div>
      
      <div class="txt-fld">
        <label for="femblem">엠뷸럼</label>
        <div>
          <input type="file" class="form-control" id="femblem" onchange="fileSelected()">
        </div>
      </div>
      
      <div class="txtarea-fld">
        <label for="fintroduce">팀 소개</label>
        <div>
          <textarea id="fintroduce" class="form-control" rows='10' cols='60'
              placeholder="팀소개를 입력해주세요."></textarea>
        </div>
      </div>
      <div class="txtarea-fld">
        <label for="faform">팀 가입양식</label>
        <div>
          <textarea id="faform" class="form-control" rows='10' cols='60'
              placeholder="팀 가입 양식을 입력해주세요."></textarea>
        </div>
      </div>
      
      <div class="btn-fld">
        <button id="regTeamBtn" type="button">추가 &raquo;</button>
      </div>
    </form>
  </div>


<!-- 수정 삭제 폼 -->
  <div id="detail_team">
    <div id="detail_team-header">
      <h2>상세 정보</h2>
      <a class="modal_close" href="#"></a>
    </div>
    <div id="detail_team_img">
      <img id="preview_img" src="img/allstardefault.png"/>
    </div>
    <form id='detailTeamForm' class="form-horizontal" enctype="multipart/form-data">
    <input id="fdtno" type="hidden"/>
    <div class="txt-fld">
      <label for="fdname">팀명</label>
      <input id="fdname" class="good_input" type="text" readonly/>
    </div>
            
    <div class="txt-fld">
      <label for="fdevent">종목</label>
      <input id="fdevent" class="good_input" type="text" readonly/>
    </div>
          
    <div class="txt-fld">
      <label for="fdtotalnum">인원수</label>
      <input id="fdtotalnum" class="good_input" type="text" placeholder="숫자를 입력해주세요."/>
    </div>
          
    <div class="txt-fld">
      <label for="fdfee">회비</label>
      <input id="fdfee" class="good_input" type="text" placeholder="숫자를 입력해주세요."/>
    </div>
          
    <div class="txt-fld">
      <label for="fdmeetday">정모요일</label>
      <input id="fdmeetday" class="good_input" type="text" placeholder="정모요일을 입력해주세요."/>
    </div>
          
      <div class="txt-fld">
        <label for="fdpostno">우편번호</label>
        <input id="fdpostno" class="good_input" type="text" placeholder="우편번호(숫자 5자리)를 입력해주세요."/>
      </div>
      
      <div class="txt-fld">
        <label for="fdaddr">연고지</label>
        <input id="fdaddr" class="good_input" type="text" placeholder="연고지를 입력해주세요."/>
      </div>
      
      <div class="txt-fld">
        <label for="fdemblem">엠뷸럼</label>
        <div>
          <input type="file" class="form-control" id="femblem" onchange="fileSelected()">
        </div>
      </div>
      
      <div class="txtarea-fld">
        <label for="fdintroduce">팀 소개</label>
        <div>
          <textarea id="fdintroduce" class="form-control" rows='10' cols='60'
              placeholder="팀소개를 입력해주세요."></textarea>
        </div>
      </div>
      <div class="txtarea-fld">
        <label for="fdaform">팀 가입양식</label>
        <div>
          <textarea id="fdaform" class="form-control" rows='10' cols='60'
              placeholder="팀 가입 양식을 입력해주세요."></textarea>
        </div>
      </div>
      
      <div class="btn-fld">
        <button id="modTeamBtn" type="button">변경 &raquo;</button>
      </div>
    </form>
  </div>

  <!---//End-content---->
  <!----wookmark-scripts---->
  <script src="../team/js/jquery.imagesloaded.js"></script>
  <script src="../team/js/jquery.wookmark.js"></script>
  <script type="text/javascript">
        (function ($){
          var $tiles = $('#tiles'),
              $handler = $('li', $tiles),
              $main = $('#main'),
              $window = $(window),
              $document = $(document),
              options = {
                autoResize: true, // This will auto-update the layout when the browser window is resized.
                container: $main, // Optional, used for some extra CSS styling
                offset: 20, // Optional, the distance between grid items
                itemWidth:280 // Optional, the width of a grid item
              },
              pageNo = 2;
              listSize = 0;
              $.getJSON('../team/ajax/all.do', function(resultObj) {
                listSize = resultObj.size;
              });
              
          /**
           * Reinitializes the wookmark handler after all images have loaded
           */
          function applyLayout() {
            $tiles.imagesLoaded(function() {
              // Destroy the old handler
              if ($handler.wookmarkInstance) {
                $handler.wookmarkInstance.clear();
              }
    
              // Create a new layout handler.
              $handler = $('li', $tiles);
              $handler.wookmark(options);
            });
          }
          
          /**
           * When scrolled all the way to the bottom, add more tiles
           */
           function onScroll() {
             if ($(window).data('ajaxready') === false)
                  return;
             
             if (listSize >= $('li', $tiles).length) {
                 // Check if we're within 100 pixels of the bottom edge of the broser window.
               var winHeight = window.innerHeight ? window.innerHeight : $window.height(), // iphone fix
                   closeToBottom = ($window.scrollTop() + winHeight > $document.height() - 500);
                 
               if (closeToBottom) {
                 $(window).data('ajaxready', false);

                 $.ajax({
                    url:'../team/ajax/list.do?pageNo=' + pageNo,
                    type:'GET',
                    async:false,
                    dataType:'json',
                    data:'resultObj',
                    success:function(resultObj) {
                      if (resultObj.teams.length != 0) {
                         pageNo++;
                         var tiles = $("#tiles");
                         for (var team of resultObj.teams) {
                           var emblem = team.emblem; 
                             
                             if(emblem == null){
                               emblem = "allstardefault.png";
                             }
                           
                             $( "<li>" )
                             .html("<img src= '../team/img/tl_" + emblem + "' width='280'>" +
                                  "<div class='post-info'>" + 
                                  "<div class='post-basic-info'>" + 
                                  "<h3><a class='detailLnk' href='#' teamNo='" + team.tno + "'>" + team.name + "</a></h3><span>" +
                                   "<a href='#'><label></label>" + "by 팀장" + "</a></span>" +
                                   "<p>" + team.event.name + "</p>" + 
                                   "<p>" + team.joinNum + " / " + team.totalNum +
                                   "</p></div></div>")
                           .appendTo(tiles);
                         }
                         // 팀 링크에 클릭 이벤트 리스너 등록
                         $("a.detailLnk").click(clickDetailLnk);
                      }
                    }
                 });

                 // 팀 이름을 클릭했을 때 호출될 함수
                 function clickDetailLnk(event) {
                   event.preventDefault();
                   location.href = "teamForm.html?tno=" + $(event.target).attr("teamNo");
                 }
                 
                 setTimeout(function() {
                   $(window).data('ajaxready', true);
                   applyLayout();
                 }, 500);
               }
             }
           };
           
          // Call the layout function for the first time
          applyLayout();
    
          // Capture scroll event.
          $window.bind('scroll.wookmark', onScroll);

        })(jQuery);
  </script>
  <!----//wookmark-scripts---->

<!-- 처음 리스트 출력 -->
  <script>
  $.ajax({
    url:'../team/ajax/list.do',
    type:'GET',
    async:false,
    dataType:'json',
    data:'resultObj',
    success:function(resultObj) {
        var tiles = $("#tiles");
        for (var team of resultObj.teams) {
          var emblem = team.emblem; 
          
          if(emblem == null){
            emblem = "allstardefault.png";
          }
          
          $("<li class='teamList' teamList='" + team.tno + "' rel='leanModal' href='#detail_team'>" )
            .html("<img src= '../team/img/tl_" + emblem + "' width='280'>" +
                  "<div class='post-info'>" + 
                  "<div class='post-basic-info'>" + 
                  "<h3>" + team.name + "</h3><span>" +
                  "<a href='#'><label></label>" + "by 팀장" + "</a></span>" +
                  "<p>" + team.event.name + "</p>" + 
                  "<p>" + team.joinNum + " / " + team.totalNum + 
                  "</p></div></div>")
            .appendTo(tiles);
          }
          // 팀 링크에 클릭 이벤트 리스너 등록
          $("a.detailLnk").click(clickDetailLnk);
       
       }
     });
  
    // 팀 이름을 클릭했을 때 호출될 함수
    function clickDetailLnk(event) {
      event.preventDefault();
      location.href = "teamForm.html?tno=" + $(event.target).attr("teamNo");
    }
  
  </script>

<!-- 상세 정보 출력 -->
<script>
  function clickDetail(event) {
    console.log(event);
    alert($(event.target).attr("teamNo"))
  }
</script>
<script>
$(".teamList").on("click", function(){
	var tno = $(this).attr('teamList');
	$.getJSON('../team/ajax/detail.do?tno=' + tno, function(
	          resultObj) {
	        var ajaxResult = resultObj.ajaxResult;
	        if (ajaxResult.status == "success") {
	          var team = ajaxResult.data;
	          $("#fdtno").val(team.tno);
	          $("#fdevent").val(team.event.name);
	          $("#fdname").val(team.name);
	          $("#fdtotalnum").val(team.totalNum);
	          $("#fdscore").val(team.win+"승 "+team.draw+"무 "+team.lose+"패");
	          $("#fdfee").val(team.fee);
	          $("#fdmeetday").val(team.meetDay);
	          $("#fdintroduce").val(team.introduce);
	          $("#fdaform").val(team.aForm);
	          $("#fdpostno").val(team.postNo);
	          $("#fdaddr").val(team.baseAddr);
	          /* $("#femblem").val(team.emblem); */
	          console.log(team.emblem + "!");
	          
	          console.log($("detail_team_img","img"));
	        }
	      });
});
</script>

<!-- 팀 추가 -->
<script>
  $(function() {
        $("#regTeamBtn").click(function() {
          var form = $('form')[0];
          var data = new FormData();
          $.each($('#femblem')[0].files, function(i, file) {
            data.append('file', file)
          });
          
          if($('#fevent').val() != "")
              data.append('eno', $('#fevent').val());
            
            if($('#fname').val() != "")
              data.append('name', $('#fname').val());
            
            if($('#ftotalnum').val() != "")
              data.append('totalNum', $('#ftotalnum').val());
            
            if($('#ffee').val() != "")
              data.append('fee', $('#ffee').val());
            
            if($('#fmeetday').val() != "")
              data.append('meetDay', $('#fmeetday').val());
            
            if($('#faddr').val() != "")
              data.append('baseAddr', $('#faddr').val());
            
            if($('#fpostno').val() != "")
              data.append('postNo', $('#fpostno').val());

            data.append('introduce', $('#fintroduce').val());
            data.append('aForm', $('#faform').val());

           $.ajax({
             url : "../team/ajax/add.do",
             data : data,
             type : "POST",
             dataType: "json",
             enctype: 'multipart/form-data',
             processData: false, 
             contentType:false,
             success : function(result) {
               console.log(result);
             if (result.ajaxResult.status == "success") {
                location.href = "/allstar/ui/teamList.html";
               } else {
                alert("팀 등록에 실패했습니다.");
               }
             },
             error : function(result){
                console.log(result)
                alert('error');
             }
           });
        });
      });
</script>

</body>
</html>