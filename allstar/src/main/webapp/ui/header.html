<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>

<link type="text/css" rel="stylesheet" href="css/header_footer.css" />

 <script type="text/javascript" src="js/jquery.cookie.js"></script>
<script type="text/javascript" src="js/jquery.session.js"></script>
 <script src="js/jquery.leanModal.min.js"></script> 
<script>

$(function() {
    $('a[rel*=leanModal]').leanModal({ top : 200, closeButton: ".modal_close" });   
});

</script>

</head>
<body>


<div id='top_header'>
<header >
<a href="main2.html"><img src="images/allstar.png" ></a>
 <div class="auth">
          <span id="login" style="display:none;">
              <a style='margin-right:10px;color:white;' id='go' rel='leanModal' href='#signup'>Login</a>
       <a style='margin-right:10px;color:white;' href='#signin' rel='leanModal'>Sign In</a>
         </span>
         <span id="logout" style="display:none;">
            <a style='margin-right:10px;color:white;' id='info' href='Member_info.html'>회원정보</a>
            <a style='margin-right:10px;color:white;' id='out' href='#'>Log out</a>
        </span>
            </div>
            <div id="cssmenu" >
              <nav >
                <ul >
                  <li  class='active has-sub' ><a href="boardList12.html"><span>종목별 게시판</span></a>
                    <ul id="eventmenu">
                    </ul>
                 </li>
                  <li class='has-sub'><a href="competitionList.html">대회</a>
                    <ul>
                      <li><a href="competitionList.html">농구</a></li>
                        <li><a href="#">축구</a></li>
                        <li><a href="#">야구</a></li>
                        <li><a href="#">볼링</a></li>
                        <li><a href="#">탁구</a></li>
                   </ul>
                </li>
                  <li class='has-sub'><a href="teamList.html">팀</a>
                    <ul>
                        <li><a href="#">농구</a></li>
                        <li><a href="#">축구</a></li>
                        <li><a href="#">야구</a></li>
                        <li><a href="#">볼링</a></li>
                        <li><a href="#">탁구</a></li>
                   </ul></li>
                       <li class='last'><a href="#">자유게시판</a></li>
              </ul>
        </nav>
        </div>
</header>
<!-- header end -->


</div>

<!-- 가입 폼 -->
<div id="signin">
      <div id="signup-ct">
        <div id="signup-header">
          <h2>회원가입</h2>
          <p>회원가입을 하세요</p>
        </div>
        
        <form action="" method="POST">
          <div class="txt-fld">
            <label for="username">Username</label>
            <input id="id_signin" class="good_input" name="username" type="text" />

          </div>
        
          <div class="txt-fld">
            <label for="password">Password</label>
            <input id="pass_signin" name="password" type="password" />

          </div>
                    <div class="txt-fld">
            <label for="password2">Password 확인</label>
            <input  name="password2" type="password" />

          </div>
          <div class="btn-fld">
          <button id="addBtn" type="submit">회원가입 &raquo;</button>
          <input type="checkbox" id="saveId"> 
          <label id="saveLabel" for="saveId">아이디 저장</label>
</div>
         </form>
      </div>
    </div>
<!-- 가입폼 끝 -->



<!-- 로그인 폼 -->

<div id="signup">
      <div id="signup-ct">
        <div id="signup-header">
          <h2>로그인</h2>
          <p>ID 와 비밀번호를 입력하세요.</p>
          <a class="modal_close" href="#"></a>
        </div>
        
        <form action="" method="POST">
            <div id="loading"></div>
          <div class="txt-fld">
            <label for="id_input">Username</label>
            <input id="id_input" class="good_input" name="username" type="text" />

          </div>
        
          <div class="txt-fld">
            <label for="pass_input">Password</label>
            <input id="pass_input" name="password" type="password" />

          </div>
          <div class="btn-fld">
          <button id="loginBtn" type="submit">로그인 &raquo;</button>
          <input type="checkbox" id="saveId"> 
          <label id="saveLabel" for="saveId">아이디 저장</label>
</div>
         </form>
      </div>
    </div>
<!-- 로그인폼 끝 -->


<!-- <script>
$.getJSON('/allstar/board/ajax/list.do?pageSize=5', function(resultObj){
    var eventmenu = $("#eventmenu");
     for (var event of resultObj.events) {
         $("<li>" )
             .html("<a href='#'>" + event.name + "</a>")
             .appendTo(eventmenu);
       }
});
</script>
 -->

<script>
//로그인 시작
$(document).ready( function() {
  var id = $.cookie("id");
  if (id != null && id != "") {
    $("#id_input").val(); 
    $("#saveId").attr("checked", "checked"); 
  }
}); 

  $('#loginBtn').click( function(event) {
         var checkStatus = $("#saveId").is(":checked");
        if (checkStatus) {
          $.cookie("id", $("#id_input").val());
        } else {
          $.cookie("id", "");
        }  
         console.log("login?");
        $.post('../auth/ajax/login.do', {
          id : $('#id_input').val(),
          password : $('#pass_input').val(),
        }, function(resultObj) {
          var ajaxResult = resultObj.ajaxResult;
          if (ajaxResult.status == "success") {
            emailSession = ajaxResult.data.id;
            number = ajaxResult.data.mno;
            $.session.set('loginSession',emailSession);
            $.session.set('mem_num',number);
            console.log("success");
          } else {
            alert("이메일과 패스워드가 일치하지 않습니다.");
          }
        }, 'json');
      });
  
  
  $(document).ready( function() {
  if ($.session.get("loginSession") != undefined) {
    $("#logout").show();
    $("#login").hide();
    console.log($.session._cookieCache["loginSession"]);
      var session_id=$.session._cookieCache["loginSession"];
      var span = $("#logout");
      $("<a style='margin-right:10px;color:white;'  href='#'>"+session_id+"</a>")
        .appendTo(span);
        
  }else {
    $("#login").show();
    $("#logout").hide();

  }
}); 
  
  $('#out').click( function(event) {
    $.session.remove("loginSession");  
    $.session.remove("mem_num");  
    console.log("logout");
    var span = $("#login");
    $("<a style='margin-right:10px;color:white;'  href='#'>가입하세요.</a>")
      .appendTo(span);
    $("#login").show();
    $("#logout").hide();
  });
  
  // 로그인 끝
  
   
    $(function() {
        $("#addBtn").click(function() {
          var form = $('form')[0];
          var data = new FormData();
          
          data.append('id', $('#id_signin').val());
          data.append('pwd', $('#pass_signin').val());
          
           $.ajax({
             url : "../member/ajax/add.do",
             data : data,
             type : "POST",
             dataType: "json",
             enctype: 'multipart/form-data',
             processData: false, 
             contentType:false,
             success : function(result) {
               console.log(result);
             if (result.ajaxResult.status == "success") {
                location.href = "/allstar/ui/main2.html";
               } else {
                alert("가입에 실패했습니다.");
               }
             },
             error : function(result){
                alert('error');
             }
           });
        });
      });
    

</script>
</body>
</html>