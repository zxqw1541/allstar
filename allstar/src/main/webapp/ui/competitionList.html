<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title></title>
<link type="text/css" rel="stylesheet" href="css/header_footer.css" />
<link rel="stylesheet" type="text/css" href="css/normalize.css" />
<link rel="stylesheet" type="text/css" href="css/component.css" />
<link rel="stylesheet" type="text/css" href="css/competition.css" />

<link rel="stylesheet" href="css/tos/tos.css" />
<link rel="Shortcut Icon" href="http://s.nx.com/s2/game/tos/common/farvicon.ico" type="image/x-icon" />
<link rel="icon" href="http://s.nx.com/s2/game/tos/common/farvicon.ico" type="image/x-icon" />

<style>
#lean_overlay {
    position: fixed;
    z-index:100;
    top: 100px;
    left: 0px;
    height:100%;
    width:100%;
    background: #000;
    display: none;
}
#detail {
  background-color: #000;
  bottom: 0;
  left: 0;
  opacity: 0.5;
  filter: alpha(opacity = 50);
  /* IE7 & 8 */ position: fixed;
  right: 0;
  top: 0;
  z-index: 99;
  display:none;
}
</style>
<script src="js/jquery-1.11.3.js"></script>
<script src="js/jquery.leanModal.min.js"></script>
<script src="js/modernizr.min.js"></script>

<script>
var pageSize = 7;
var url = '';
$(function(){
  $("#header").load("header.html"); 
  $("#footer").load("footer.html"); 
});

$(function() {
    $('a[rel*=leanModal]').leanModal({ closeButton: ".modal_close" });   
});

</script> 
<script type="text/javascript" src="js/jquery.session.js"></script>
</head>
<body>
<div id="header"></div>
<div style="height:100px;"></div>

<div id="container">

<div id="content">
  <div class="boardContents boardList">
    <div class="innerWrap">
      <div class="listWrap">
        <div class="listHeader clearFix">
          <h2 class="snbTitSub tit">대회 게시판</h2>
          <div class="sort">
            <ul class="list">
              <li><a href="#" id="lnewer" class='on'>최신순</a></li>
              <li><a href="#" id="lreply">댓글순</a></li>
            </ul>
          </div>
        </div>
        
        <div class="boardList listType1">
          <table id="boardtable">
            <caption>대회 리스트</caption>
            <thead>
              <tr>
                <th class="th1" scope="col">종목</th>
                <th class="th2" scope="col">제목</th>
                <th class="th3" scope="col">작성자</th>
                <th class="th4" scope="col">조회</th>
              </tr>
            </thead>
            <tbody>
              <tr>
              </tr>
              <!-- 리스트 출력 -->
            </tbody>
          </table>
        </div>
        
        <div class="btnArea clearFix">
          <p class="fR">
              <a id="newBtn" rel='leanModal' href="#newWrite" class="btn btnType1 btnWrite">글쓰기</a>
          </p>
        </div>
        <div class="paging">
          <!-- 페이징 처리 부분 -->
        </div>
        
        <fieldset class="searchArea">
          <select id="csearch">
            <option value="1">대회명</option>
            <option value="2">내용</option>
          </select>
          <input type="text" id="ccontent" class="inputTxt" />
          <input type="submit" value="검색" onclick="return search();" id="csearchClick" class="btnSearch btn" />
        </fieldset>
      </div>
    </div>
  </div>
</div>
</div>

<div id="contents" style='display:none; background-color: white; min-width:1258px; margin:auto; overflow:auto;'>
  <div class="viewWrap boardContents boardView" style="width:100%; overflow-y:auto;">
    <article id="subject" class="mainArea">
    </article>
    <aside id="rightSide" class="sideArea">
    </aside>

  </div>
</div>

<div id="newWrite" style=' display:none; border:1px black solid; background-color: white; width:auto; /* margin:auto; */ left:40%; overflow:auto;'>
  <div id="newBoard" class="viewWrap boardContents boardView" style="width:100%; overflow-y:auto;">
    
              
  </div>
      <div class="form-group">
        <div class="col-sm-offset-2 col-sm-10" style="margin-left:30%;">
          <button id='addBtn' type='button' class="newForm btn btn-primary btn-xs">등록</button>
        </div>
      </div>
</div> 
<div id="footer"></div>

 

<!-- 대회 리스트 출력 -->
<script>
var pageNo = 1;
var search = '';

if (location.href.indexOf('?') != -1)
	pageNo = location.href.split('?')[1].split('=')[1].split('&')[0];
	
  url = '/allstar/competition/list.do?pageSize=' + pageSize + '&pageNo=' + pageNo;

if (location.href.indexOf('&') != -1) {
	search = location.href.split('&')[1].split('=')[0];
	if (search == 'search1') {
		url = url + "&search1=" + location.href.split('&')[1].split('=')[1];
	}
	else {
		url = url + "&search2=" + location.href.split('&')[1].split('=')[1];
	}
}

$.getJSON(url, function(resultObj) {
  var tbody = $("#boardtable tbody");
  for (var c of resultObj.ajaxResult.data) {
    $("<tr>")
    .html(
    "<td class='num'>" + c.event.name +"</td>"
    + "<td class='subject'><a href='#' data-ajax-board='free_view' articlesn=" + c.cno + "><strong>" + c.name + "<small>(3)</small></strong>"
    + "<span class='info' id='time'>모집기간 : " + c.recruitStartDate + " ~ " + c.recruitEndDate + "</span></a></td>"
    + "<td class='author'><div class='contents'><p class='name name2'>" + c.startDate + "</p></div></td>"
    + "<td class='cnt'><span class='view'>" + c.joinNum + " / " + c.teamNum + "</span><span class='like'>" + c.baseAddr +"</span></td>"
    )
    .appendTo(tbody);
  }
});
</script>

<!-- 페이징 -->
<script>
var totalPage = 1;

var url1 = '/allstar/competition/all.do';

if (location.href.indexOf('&') != -1) {
  search = location.href.split('&')[1].split('=')[0];
  if (search == 'search1') {
    url1 = url1 + "?search1=" + location.href.split('&')[1].split('=')[1];
  }
  else {
    url1 = url1 + "?search2=" + location.href.split('&')[1].split('=')[1];
  }
}
$.getJSON(url1, function(resultObj) {
	  totalPage = Math.ceil(resultObj.ajaxResult.data / pageSize);
	  var lp10 = Math.floor((totalPage - 1) / 10) * 10;
	  var start = Math.floor((pageNo - 1) / 10) * 10 + 1;
	  var end = start + 10;
	  
	  if (end > totalPage)
		  end = totalPage + 1;
	  
	  var pagingDiv = $('.paging');

	  /* <<, < 버튼 추가 */
	  if (start < 11) {
		  $("<span>").addClass('fir').appendTo(pagingDiv);
      $("<span>").addClass('prev').appendTo(pagingDiv);
	  }
	  else {
		  $("<a>").addClass('fir').attr({href:'#'}).appendTo(pagingDiv);
      $("<a>").addClass('prev').attr({href:'#'}).appendTo(pagingDiv);
		  $('a.fir').click(clickFir);
	    $('a.prev').click(clickPrev);
	  }
	  
	  /* 숫자 */
		var pageDiv = $('<div>').addClass('page_num');
	  pageDiv.appendTo(pagingDiv);
	  for (var i = start ; i < end ; i++) {
		  if(i == pageNo) {
			  $("<span>").addClass('nowpage')
			  .html("<b>"+ i + "</b>").appendTo(pageDiv); 
		  } else {
		    $("<a>")
		    .addClass('a_pageNo')
		    .attr({
		    	href : '#',
		    	pageno : i
		    	})
		    .html(i).appendTo(pageDiv);
		  }
	  };
	  $(".a_pageNo").click(clickPageNo)
	  
	  /* >, >> 버튼 추가 */
	  if (pageNo > lp10) {
      $("<span>").addClass('next').appendTo(pagingDiv);
	    $("<span>").addClass('end').appendTo(pagingDiv);
	  }
    else {
      $("<a>").addClass('next').attr({href:'#'}).appendTo(pagingDiv);
	    $("<a>").addClass('end').attr({href:'#'}).appendTo(pagingDiv);
 	    $('a.next').click(clickNext);
  	  $('a.end').click(clickEnd);
    }
});

//페이징 번호를 클릭했을 때 호출될 함수
function clickPageNo(event) {
	event.preventDefault();
  location.href = "competitionList.html?pageNo=" + $(event.target).attr("pageno");
}

//<<버튼을 클릭했을 때 호출될 함수
function clickFir() {
  event.preventDefault();
  location.href = "competitionList.html";
}

//<버튼을 클릭했을 때 호출될 함수
function clickPrev() {
  event.preventDefault();
  var no = Math.floor((pageNo - 11) / 10) * 10 + parseInt(1);
  location.href = "competitionList.html?pageNo=" + no;
}

//>버튼을 클릭했을 때 호출될 함수
function clickNext() {
	event.preventDefault();
	var no = Math.floor((pageNo*1 + parseInt(9)) / 10) * 10 + parseInt(1);
	location.href = "competitionList.html?pageNo=" + no;
}

//>>버튼을 클릭했을 때 호출될 함수
function clickEnd() {
  event.preventDefault();
  location.href = "competitionList.html?pageNo=" + totalPage;
}
</script>

<!-- 검색 -->
<script>
function search() {
	var select = $('#csearch option:selected').val();
	if (select == '1') {
		location.href = "competitionList.html?pageNo=" + pageNo + "&search1=" + $("#ccontent").val();
	}
	else {
	  location.href = "competitionList.html?pageNo=" + pageNo + "&search2=" + $("#ccontent").val();
	}
}
</script>

</body>
</html>